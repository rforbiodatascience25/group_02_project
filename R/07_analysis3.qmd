---
title: "07_analysis3"
format: html
embed-resources: true
---

A

```{r}
library(tidyverse)

plot_data <- analysis_data |>
  group_by(Age_Group, Strains) |>
  summarise(n = n(), .groups = "drop") |>
  group_by(Age_Group) |>
  mutate(rate = 100 * n / sum(n)) |>
  ungroup() |>
  mutate(Strains = factor(Strains, levels = 0:3))

ggplot(plot_data,
       aes(x = as.numeric(as.character(Strains)),
           y = rate,
           fill = Age_Group)) +
  geom_col(position = "dodge", colour = "black", width = 0.7) +
  scale_x_continuous(breaks = 0:3, labels = 0:3) +
  scale_fill_manual(values = c("Older" = "white", "Young" = "black")) +
  geom_vline(xintercept = 1.5, linetype = "dashed") +
  labs(x = "Number of strains",
       y = "Seroconversion rate (%)",
       fill = NULL) +
  theme_bw() +
  theme(panel.grid = element_blank())
```

B

```{r}
plot_b_data <- analysis_data |>
  count(Age_Group, Response_group) |>
  group_by(Age_Group) |>
  mutate(percent = 100 * n / sum(n),
         Response_group = factor(Response_group, levels = c("Poor responders", "Good responders"))) |>
  ungroup()

ggplot(plot_b_data,
       aes(x = Age_Group,
           y = percent,
           fill = Response_group)) +
  geom_col(position = "fill", width = 0.6, colour = "black") +
  scale_y_continuous(labels = scales::percent_format()) +
  scale_fill_manual(values = c("Poor responders" = "white", "Good responders" = "black"),
                    labels = c("NR", "R")) +
  labs(x = NULL,
       y = "Percent response",
       fill = NULL) +
  theme_bw() +
  theme(panel.grid = element_blank(),
        axis.text.x = element_text(size = 12),
        axis.text.y = element_text(size = 12))
```

C

```{r}

```
